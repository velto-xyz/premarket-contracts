{"abi":[{"type":"constructor","inputs":[{"name":"_baseReserve","type":"uint256","internalType":"uint256"},{"name":"_quoteReserve","type":"uint256","internalType":"uint256"}],"stateMutability":"nonpayable"},{"type":"function","name":"PRECISION","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"advanceBlocks","inputs":[{"name":"numBlocks","type":"uint256","internalType":"uint256"}],"outputs":[],"stateMutability":"nonpayable"},{"type":"function","name":"baseReserve","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"cumulativeCarryIndex","inputs":[],"outputs":[{"name":"","type":"int256","internalType":"int256"}],"stateMutability":"view"},{"type":"function","name":"currentBlock","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"decreaseOpenInterest","inputs":[{"name":"isLong","type":"bool","internalType":"bool"},{"name":"notional","type":"uint256","internalType":"uint256"}],"outputs":[],"stateMutability":"nonpayable"},{"type":"function","name":"engine","inputs":[],"outputs":[{"name":"","type":"address","internalType":"address"}],"stateMutability":"view"},{"type":"function","name":"executeCloseLong","inputs":[{"name":"baseSize","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"quoteOut","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"nonpayable"},{"type":"function","name":"executeCloseShort","inputs":[{"name":"baseSize","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"quoteIn","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"nonpayable"},{"type":"function","name":"executeOpenLong","inputs":[{"name":"quoteIn","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"baseOut","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"nonpayable"},{"type":"function","name":"executeOpenShort","inputs":[{"name":"quoteOut","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"baseIn","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"nonpayable"},{"type":"function","name":"factory","inputs":[],"outputs":[{"name":"","type":"address","internalType":"address"}],"stateMutability":"view"},{"type":"function","name":"getMarkPrice","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"increaseOpenInterest","inputs":[{"name":"isLong","type":"bool","internalType":"bool"},{"name":"notional","type":"uint256","internalType":"uint256"}],"outputs":[],"stateMutability":"nonpayable"},{"type":"function","name":"k","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"lastFundingBlock","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"longOpenInterest","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"quoteReserve","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"setEngine","inputs":[{"name":"_engine","type":"address","internalType":"address"}],"outputs":[],"stateMutability":"nonpayable"},{"type":"function","name":"shortOpenInterest","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"simulateCloseLong","inputs":[{"name":"baseSize","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"quoteOut","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"simulateCloseShort","inputs":[{"name":"baseSize","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"quoteIn","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"simulateOpenLong","inputs":[{"name":"quoteIn","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"baseOut","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"simulateOpenShort","inputs":[{"name":"quoteOut","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"baseIn","type":"uint256","internalType":"uint256"},{"name":"avgPrice","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"updateFundingState","inputs":[{"name":"newCarryIndex","type":"int256","internalType":"int256"},{"name":"newFundingBlock","type":"uint256","internalType":"uint256"}],"outputs":[],"stateMutability":"nonpayable"},{"type":"event","name":"OpenInterestUpdated","inputs":[{"name":"longOpenInterest","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"shortOpenInterest","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"type":"event","name":"ReservesUpdated","inputs":[{"name":"baseReserve","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"quoteReserve","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"markPrice","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"type":"error","name":"EngineAlreadySet","inputs":[]},{"type":"error","name":"InsufficientLiquidity","inputs":[]},{"type":"error","name":"InvalidReserves","inputs":[]},{"type":"error","name":"Unauthorized","inputs":[]}],"bytecode":{"object":"0x60a0346100c957601f610f7938819003918201601f19168301916001600160401b038311848410176100cd5780849260409485528339810103126100c957602081519101518115908180156100c1575b6100af57825f558060015580830292830414171561009b5760025560016005555f600655600160075533608052604051610e9790816100e2823960805181818161051701526109ea0152f35b634e487b7160e01b5f52601160045260245ffd5b604051633dce448b60e11b8152600490fd5b50801561004f565b5f80fd5b634e487b7160e01b5f52604160045260245ffdfe6080604081815260049182361015610015575f80fd5b5f3560e01c90816301a828a314610ad557508063097870ae14610a6a5780630e830e491461099457806315f54f9a1461095957806319a65533146108fe5780634338ae47146108c35780634cb31779146108595780634e1587f6146107a557806360409632146107645780636c979157146106e257806377fac304146106a6578063972fcff31461066b57806397fb72891461062f5780639da771f4146105f3578063a40f1e00146105b7578063aaf5eb6814610577578063b4f40c611461053b578063c45a0155146104cd578063c4b0340a146103ec578063c9d4623f1461039a578063ca438c711461022d578063dfdf2a72146101f2578063e12ed13c146101b6578063edbae33a1461016f5763f67908b514610132575f80fd5b3461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b57602091549051908152f35b5f80fd5b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610dfa565b82519182526020820152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906005549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020905f549051908152f35b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff600854163303610373576102979061028d83610d79565b9290935f54610ba9565b90815f556102a782600254610ba9565b907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82019182116103475750906102ff817fe66cd0d1751b6e82cb9f412f722b6dea0a1eeca0fbc1b9c8c2972f16d228ee2a93610bf0565b908160015561030e8282610c27565b60025561033861031c610d51565b8751938493846040919493926060820195825260208201520152565b0390a182519182526020820152f35b6011907f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b82517f82b42900000000000000000000000000000000000000000000000000000000008152fd5b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5760209073ffffffffffffffffffffffffffffffffffffffff600854169051908152f35b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff600854163303610373576104579061044c83610cc0565b929093600154610be3565b908160015561046882600254610ba9565b907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82019182116103475750906104c0817fe66cd0d1751b6e82cb9f412f722b6dea0a1eeca0fbc1b9c8c2972f16d228ee2a93610bf0565b805f5561030e8282610c27565b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020905173ffffffffffffffffffffffffffffffffffffffff7f0000000000000000000000000000000000000000000000000000000000000000168152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906002549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5760209051670de0b6b3a76400008152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906007549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906001549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906003549051908152f35b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610d79565b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906006549051908152f35b503461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5773ffffffffffffffffffffffffffffffffffffffff60085416330361073e575035600554016005555f80f35b517f82b42900000000000000000000000000000000000000000000000000000000008152fd5b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5760209061079e610d51565b9051908152f35b503461016b576107b436610b6c565b73ffffffffffffffffffffffffffffffffffffffff600894929454163303610831577fec9d3d15d27b45ec272eca821314dbc7dfac39e122618a8cbfb23ca99d19c883931561081f5761080990600354610be3565b6003555b600354905482519182526020820152a1005b61082a908254610be3565b815561080d565b5090517f82b42900000000000000000000000000000000000000000000000000000000008152fd5b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff60085416330361037357610297906108b983610dfa565b9290935f54610be3565b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610cc0565b503461016b57807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5773ffffffffffffffffffffffffffffffffffffffff60085416330361073e575035600655602435600755005b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610c3a565b503461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5781359173ffffffffffffffffffffffffffffffffffffffff9182841680940361016b57827f000000000000000000000000000000000000000000000000000000000000000016330361073e57600854928316610a44577fffffffffffffffffffffffff000000000000000000000000000000000000000083168417600855005b517fe6123baf000000000000000000000000000000000000000000000000000000008152fd5b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff6008541633036103735761045790610aca83610c3a565b929093600154610ba9565b82843461016b57610ae536610b6c565b909373ffffffffffffffffffffffffffffffffffffffff600854163303610b4557507fec9d3d15d27b45ec272eca821314dbc7dfac39e122618a8cbfb23ca99d19c8839315610b3a5761080990600354610ba9565b61082a908254610ba9565b90507f82b42900000000000000000000000000000000000000000000000000000000008152fd5b7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc604091011261016b57600435801515810361016b579060243590565b91908201809211610bb657565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b91908203918211610bb657565b8115610bfa570490565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b81810292918115918404141715610bb657565b908115610cb957610c4d82600154610ba9565b610c5981600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610c9791610c9091610bf0565b5f54610be3565b91670de0b6b3a764000080820291820403610bb65782610cb691610bf0565b90565b5f91508190565b908115610cb95760015480831015610d275782610cdc91610be3565b610ce881600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610c9791610d1f91610bf0565b5f5490610be3565b60046040517fbb55fd27000000000000000000000000000000000000000000000000000000008152fd5b600154670de0b6b3a764000090818102918183041490151715610bb6575f54610cb691610bf0565b908115610cb957610d8b825f54610ba9565b610d9781600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610dd691610dce91610bf0565b600154610be3565b91670de0b6b3a764000090818402918483041484151715610bb657610cb691610bf0565b908115610cb9575f5480831015610d275782610e1591610be3565b610e2181600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610dd691610e5891610bf0565b60015490610be356fea264697066735822122077df8344ca9d796816c889201a8ced6c5be4284e7bce89d7502e77f9d0b0241f64736f6c63430008170033","sourceMap":"373:13428:34:-:0;;;;;;;;;;;;;-1:-1:-1;;373:13428:34;;;;-1:-1:-1;;;;;373:13428:34;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2504:17;;:39;;;;;;-1:-1:-1;2500:69:34;;373:13428;-1:-1:-1;373:13428:34;;;;;;;;;;;;;;;2654:32;373:13428;;2696:16;373:13428;-1:-1:-1;2742:24:34;373:13428;;2790:20;373:13428;2852:10;2842:20;;373:13428;;;;;;;;2842:20;373:13428;;;;;;;;;;;;;;;-1:-1:-1;373:13428:34;;;;;-1:-1:-1;373:13428:34;2500:69;373:13428;;-1:-1:-1;;;2552:17:34;;;;;2504:39;2525:18;;;2504:39;;373:13428;-1:-1:-1;373:13428:34;;;;;;-1:-1:-1;373:13428:34;;;;;-1:-1:-1;373:13428:34","linkReferences":{}},"deployedBytecode":{"object":"0x6080604081815260049182361015610015575f80fd5b5f3560e01c90816301a828a314610ad557508063097870ae14610a6a5780630e830e491461099457806315f54f9a1461095957806319a65533146108fe5780634338ae47146108c35780634cb31779146108595780634e1587f6146107a557806360409632146107645780636c979157146106e257806377fac304146106a6578063972fcff31461066b57806397fb72891461062f5780639da771f4146105f3578063a40f1e00146105b7578063aaf5eb6814610577578063b4f40c611461053b578063c45a0155146104cd578063c4b0340a146103ec578063c9d4623f1461039a578063ca438c711461022d578063dfdf2a72146101f2578063e12ed13c146101b6578063edbae33a1461016f5763f67908b514610132575f80fd5b3461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b57602091549051908152f35b5f80fd5b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610dfa565b82519182526020820152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906005549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020905f549051908152f35b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff600854163303610373576102979061028d83610d79565b9290935f54610ba9565b90815f556102a782600254610ba9565b907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82019182116103475750906102ff817fe66cd0d1751b6e82cb9f412f722b6dea0a1eeca0fbc1b9c8c2972f16d228ee2a93610bf0565b908160015561030e8282610c27565b60025561033861031c610d51565b8751938493846040919493926060820195825260208201520152565b0390a182519182526020820152f35b6011907f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b82517f82b42900000000000000000000000000000000000000000000000000000000008152fd5b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5760209073ffffffffffffffffffffffffffffffffffffffff600854169051908152f35b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff600854163303610373576104579061044c83610cc0565b929093600154610be3565b908160015561046882600254610ba9565b907fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82019182116103475750906104c0817fe66cd0d1751b6e82cb9f412f722b6dea0a1eeca0fbc1b9c8c2972f16d228ee2a93610bf0565b805f5561030e8282610c27565b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020905173ffffffffffffffffffffffffffffffffffffffff7f0000000000000000000000000000000000000000000000000000000000000000168152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906002549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5760209051670de0b6b3a76400008152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906007549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906001549051908152f35b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906003549051908152f35b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610d79565b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576020906006549051908152f35b503461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5773ffffffffffffffffffffffffffffffffffffffff60085416330361073e575035600554016005555f80f35b517f82b42900000000000000000000000000000000000000000000000000000000008152fd5b503461016b575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5760209061079e610d51565b9051908152f35b503461016b576107b436610b6c565b73ffffffffffffffffffffffffffffffffffffffff600894929454163303610831577fec9d3d15d27b45ec272eca821314dbc7dfac39e122618a8cbfb23ca99d19c883931561081f5761080990600354610be3565b6003555b600354905482519182526020820152a1005b61082a908254610be3565b815561080d565b5090517f82b42900000000000000000000000000000000000000000000000000000000008152fd5b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff60085416330361037357610297906108b983610dfa565b9290935f54610be3565b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610cc0565b503461016b57807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5773ffffffffffffffffffffffffffffffffffffffff60085416330361073e575035600655602435600755005b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b576101aa9035610c3a565b503461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5781359173ffffffffffffffffffffffffffffffffffffffff9182841680940361016b57827f000000000000000000000000000000000000000000000000000000000000000016330361073e57600854928316610a44577fffffffffffffffffffffffff000000000000000000000000000000000000000083168417600855005b517fe6123baf000000000000000000000000000000000000000000000000000000008152fd5b50903461016b5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261016b5780359073ffffffffffffffffffffffffffffffffffffffff6008541633036103735761045790610aca83610c3a565b929093600154610ba9565b82843461016b57610ae536610b6c565b909373ffffffffffffffffffffffffffffffffffffffff600854163303610b4557507fec9d3d15d27b45ec272eca821314dbc7dfac39e122618a8cbfb23ca99d19c8839315610b3a5761080990600354610ba9565b61082a908254610ba9565b90507f82b42900000000000000000000000000000000000000000000000000000000008152fd5b7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc604091011261016b57600435801515810361016b579060243590565b91908201809211610bb657565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b91908203918211610bb657565b8115610bfa570490565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b81810292918115918404141715610bb657565b908115610cb957610c4d82600154610ba9565b610c5981600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610c9791610c9091610bf0565b5f54610be3565b91670de0b6b3a764000080820291820403610bb65782610cb691610bf0565b90565b5f91508190565b908115610cb95760015480831015610d275782610cdc91610be3565b610ce881600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610c9791610d1f91610bf0565b5f5490610be3565b60046040517fbb55fd27000000000000000000000000000000000000000000000000000000008152fd5b600154670de0b6b3a764000090818102918183041490151715610bb6575f54610cb691610bf0565b908115610cb957610d8b825f54610ba9565b610d9781600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610dd691610dce91610bf0565b600154610be3565b91670de0b6b3a764000090818402918483041484151715610bb657610cb691610bf0565b908115610cb9575f5480831015610d275782610e1591610be3565b610e2181600254610ba9565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8101908111610bb657610dd691610e5891610bf0565b60015490610be356fea264697066735822122077df8344ca9d796816c889201a8ced6c5be4284e7bce89d7502e77f9d0b0241f64736f6c63430008170033","sourceMap":"373:13428:34:-:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;;;;;;;;;;;;;;;1147:27;373:13428;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2192:6;373:13428;;2178:10;:20;2174:47;;11043:23;10956:27;;;;:::i;:::-;373:13428;;;;;11043:23;:::i;:::-;373:13428;;;;11092:15;373:13428;11092:1;373:13428;11092:15;:::i;:::-;373:13428;;;;;;;;;11091:35;;;;11263:58;11091:35;;:::i;:::-;373:13428;;;;11221:26;;;;:::i;:::-;11092:1;373:13428;11263:58;11306:14;;:::i;:::-;373:13428;;11263:58;;;;373:13428;;;;;;;;;;;;;;;;;;11263:58;;;;373:13428;;;;;;;;;;;;;;;;;;;;2174:47;373:13428;;2207:14;;;;373:13428;;;;;;;;;;;;;;;1535:21;373:13428;;;;;;;;;;;;;;;;;;;;;;;;;2192:6;373:13428;;2178:10;:20;2174:47;;10259:24;10172:27;;;;:::i;:::-;373:13428;;;;;10259:24;:::i;:::-;373:13428;;;;10308:16;373:13428;10308:1;373:13428;10308:16;:::i;:::-;373:13428;;;;;;;;;10307:37;;;;10481:58;10307:37;;:::i;:::-;373:13428;;;10439:26;;;;:::i;373:13428::-;;;;;;;;;;;;;;;;1629:32;373:13428;;;;;;;;;;;;;;;;;;846:16;373:13428;;;;;;;;;;;;;;;;;;;;;;479:4;373:13428;;;;;;;;;;;;;;;;;1428:31;373:13428;;;;;;;;;;;;;;;;;;;;;688:27;373:13428;;;;;;;;;;;;;;;;;;;;;938:31;373:13428;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;;;;1337:34;373:13428;;;;;;;;;;;;;;;;;;;;2192:6;373:13428;;2178:10;:20;2174:47;;373:13428;;13286:25;373:13428;;13286:25;373:13428;;;;2174:47;373:13428;2207:14;;;;373:13428;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;;;;;:::i;:::-;;2192:6;373:13428;;;;;2178:10;:20;2174:47;;12991:56;;12851:125;;;12877:28;373:13428;12877:28;373:13428;12877:28;:::i;:::-;;373:13428;12851:125;13011:16;373:13428;;;;;;;;;;;;12991:56;373:13428;12851:125;12936:29;373:13428;;;12936:29;:::i;:::-;373:13428;;12851:125;;2174:47;373:13428;;;2207:14;;;;373:13428;;;;;;;;;;;;;;;;;2192:6;373:13428;;2178:10;:20;2174:47;;11824:23;11736:28;;;;:::i;:::-;373:13428;;;;;11824:23;:::i;373:13428::-;;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;;;2192:6;373:13428;;2178:10;:20;2174:47;;-1:-1:-1;373:13428:34;13712:36;373:13428;;;13758:34;373:13428;;;;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;;;;;;;;;;;;;;;3121:7;;373:13428;3107:10;:21;3103:48;;3165:6;373:13428;;;;3161:51;;373:13428;;;;;3165:6;373:13428;;3161:51;373:13428;3194:18;;;;373:13428;;;;;;;;;;;;;;;;;2192:6;373:13428;;2178:10;:20;2174:47;;9474:23;9389:25;;;;:::i;:::-;373:13428;;;;;9474:23;:::i;373:13428::-;;;;;;;;;:::i;:::-;;;;2192:6;373:13428;;2178:10;:20;2174:47;;-1:-1:-1;12512:56:34;;12372:125;;;12398:28;373:13428;12398:28;373:13428;12398:28;:::i;12372:125::-;12457:29;373:13428;;;12457:29;:::i;2174:47::-;2207:14;;;;;;373:13428;;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;:::o;4224:818::-;;4365:12;;4361:31;;4470:22;373:13428;4470:12;373:13428;4470:22;:::i;:::-;4792:19;373:13428;4792:1;373:13428;4792:19;:::i;:::-;373:13428;;;;;;;;4901:28;4791:43;;;;:::i;:::-;4376:1;373:13428;4901:28;:::i;:::-;479:4;;373:13428;;;;;;;;;5004:31;;;;:::i;:::-;4224:818;:::o;4361:31::-;4376:1;;-1:-1:-1;4376:1:34;;4379:13::o;5561:793::-;;5703:13;;5699:32;;5757:12;373:13428;5745:24;;;;5741:60;;5884:23;;;;:::i;:::-;6106:19;373:13428;6106:1;373:13428;6106:19;:::i;:::-;373:13428;;;;;;;;6213:28;6105:43;;;;:::i;:::-;5715:1;373:13428;6213:28;;:::i;5741:60::-;5778:23;373:13428;;5778:23;;;;3523:118;3595:12;373:13428;479:4;373:13428;;;;;;;;;;;;;;;-1:-1:-1;373:13428:34;3594:40;;;:::i;6870:729::-;;7014:13;;7010:32;;7118:22;373:13428;7026:1;373:13428;7118:22;:::i;:::-;7343:18;373:13428;7343:1;373:13428;7343:18;:::i;:::-;373:13428;;;;;;;;7452:30;7342:41;;;;:::i;:::-;7364:1;373:13428;7452:30;:::i;:::-;479:4;;373:13428;;;;;;;;;;;;;;;7559:33;;;:::i;8112:798::-;;8256:13;;8252:32;;8268:1;373:13428;8298:23;;;;8294:59;;8434:22;;;;:::i;:::-;8658:18;373:13428;8658:1;373:13428;8658:18;:::i;:::-;373:13428;;;;;;;;8765:30;8657:41;;;;:::i;:::-;8679:1;373:13428;8765:30;;:::i","linkReferences":{},"immutableReferences":{"39883":[{"start":1303,"length":32},{"start":2538,"length":32}]}},"methodIdentifiers":{"PRECISION()":"aaf5eb68","advanceBlocks(uint256)":"6c979157","baseReserve()":"dfdf2a72","cumulativeCarryIndex()":"77fac304","currentBlock()":"e12ed13c","decreaseOpenInterest(bool,uint256)":"4e1587f6","engine()":"c9d4623f","executeCloseLong(uint256)":"ca438c71","executeCloseShort(uint256)":"4cb31779","executeOpenLong(uint256)":"097870ae","executeOpenShort(uint256)":"c4b0340a","factory()":"c45a0155","getMarkPrice()":"60409632","increaseOpenInterest(bool,uint256)":"01a828a3","k()":"b4f40c61","lastFundingBlock()":"a40f1e00","longOpenInterest()":"97fb7289","quoteReserve()":"9da771f4","setEngine(address)":"0e830e49","shortOpenInterest()":"f67908b5","simulateCloseLong(uint256)":"972fcff3","simulateCloseShort(uint256)":"edbae33a","simulateOpenLong(uint256)":"15f54f9a","simulateOpenShort(uint256)":"4338ae47","updateFundingState(int256,uint256)":"19a65533"},"rawMetadata":"{\"compiler\":{\"version\":\"0.8.23+commit.f704f362\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_baseReserve\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"_quoteReserve\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"inputs\":[],\"name\":\"EngineAlreadySet\",\"type\":\"error\"},{\"inputs\":[],\"name\":\"InsufficientLiquidity\",\"type\":\"error\"},{\"inputs\":[],\"name\":\"InvalidReserves\",\"type\":\"error\"},{\"inputs\":[],\"name\":\"Unauthorized\",\"type\":\"error\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"longOpenInterest\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"shortOpenInterest\",\"type\":\"uint256\"}],\"name\":\"OpenInterestUpdated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"baseReserve\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"quoteReserve\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"markPrice\",\"type\":\"uint256\"}],\"name\":\"ReservesUpdated\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"PRECISION\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"numBlocks\",\"type\":\"uint256\"}],\"name\":\"advanceBlocks\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"baseReserve\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"cumulativeCarryIndex\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"\",\"type\":\"int256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"currentBlock\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bool\",\"name\":\"isLong\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"notional\",\"type\":\"uint256\"}],\"name\":\"decreaseOpenInterest\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"engine\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"baseSize\",\"type\":\"uint256\"}],\"name\":\"executeCloseLong\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteOut\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"baseSize\",\"type\":\"uint256\"}],\"name\":\"executeCloseShort\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteIn\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteIn\",\"type\":\"uint256\"}],\"name\":\"executeOpenLong\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"baseOut\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteOut\",\"type\":\"uint256\"}],\"name\":\"executeOpenShort\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"baseIn\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"factory\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getMarkPrice\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"bool\",\"name\":\"isLong\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"notional\",\"type\":\"uint256\"}],\"name\":\"increaseOpenInterest\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"k\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"lastFundingBlock\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"longOpenInterest\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"quoteReserve\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_engine\",\"type\":\"address\"}],\"name\":\"setEngine\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"shortOpenInterest\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"baseSize\",\"type\":\"uint256\"}],\"name\":\"simulateCloseLong\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteOut\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"baseSize\",\"type\":\"uint256\"}],\"name\":\"simulateCloseShort\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteIn\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteIn\",\"type\":\"uint256\"}],\"name\":\"simulateOpenLong\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"baseOut\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"quoteOut\",\"type\":\"uint256\"}],\"name\":\"simulateOpenShort\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"baseIn\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"avgPrice\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"int256\",\"name\":\"newCarryIndex\",\"type\":\"int256\"},{\"internalType\":\"uint256\",\"name\":\"newFundingBlock\",\"type\":\"uint256\"}],\"name\":\"updateFundingState\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}],\"devdoc\":{\"details\":\"Implements constant product market maker: k = baseReserve * quoteReserve Maps to perp.js lines 460-571 (vAMM simulation functions) Critical: All math must match JavaScript implementation within 1e-15 precision\",\"kind\":\"dev\",\"methods\":{\"advanceBlocks(uint256)\":{\"params\":{\"numBlocks\":\"Number of blocks to advance\"}},\"constructor\":{\"params\":{\"_baseReserve\":\"Initial base reserve (18 decimals)\",\"_quoteReserve\":\"Initial quote reserve (18 decimals)\"}},\"decreaseOpenInterest(bool,uint256)\":{\"params\":{\"isLong\":\"True for long, false for short\",\"notional\":\"Notional value to remove (18 decimals)\"}},\"executeCloseLong(uint256)\":{\"params\":{\"baseSize\":\"Amount of base tokens to sell\"},\"returns\":{\"avgPrice\":\"Average execution price\",\"quoteOut\":\"Amount of quote tokens received\"}},\"executeCloseShort(uint256)\":{\"params\":{\"baseSize\":\"Amount of base tokens to buy\"},\"returns\":{\"avgPrice\":\"Average execution price\",\"quoteIn\":\"Amount of quote tokens required\"}},\"executeOpenLong(uint256)\":{\"params\":{\"quoteIn\":\"Amount of quote tokens to spend\"},\"returns\":{\"avgPrice\":\"Average execution price\",\"baseOut\":\"Amount of base tokens received\"}},\"executeOpenShort(uint256)\":{\"params\":{\"quoteOut\":\"Desired notional value in quote tokens\"},\"returns\":{\"avgPrice\":\"Average execution price\",\"baseIn\":\"Amount of base tokens required\"}},\"getMarkPrice()\":{\"details\":\"Mark price = quoteReserve / baseReserve\",\"returns\":{\"_0\":\"Mark price in 18 decimal precision Maps to perp.js lines 364-366\"}},\"increaseOpenInterest(bool,uint256)\":{\"params\":{\"isLong\":\"True for long, false for short\",\"notional\":\"Notional value to add (18 decimals)\"}},\"setEngine(address)\":{\"params\":{\"_engine\":\"Address of PerpEngine\"}},\"simulateCloseLong(uint256)\":{\"params\":{\"baseSize\":\"Amount of base tokens to sell (18 decimals)\"},\"returns\":{\"avgPrice\":\"Average execution price Maps to perp.js lines 533-544 Math: - newBaseReserve = baseReserve + baseSize - newQuoteReserve = k / newBaseReserve - quoteOut = quoteReserve - newQuoteReserve - avgPrice = quoteOut / baseSize\",\"quoteOut\":\"Amount of quote tokens received\"}},\"simulateCloseShort(uint256)\":{\"params\":{\"baseSize\":\"Amount of base tokens to buy (18 decimals)\"},\"returns\":{\"avgPrice\":\"Average execution price Maps to perp.js lines 558-571 Math: - newBaseReserve = baseReserve - baseSize - newQuoteReserve = k / newBaseReserve - quoteIn = newQuoteReserve - quoteReserve - avgPrice = quoteIn / baseSize\",\"quoteIn\":\"Amount of quote tokens required\"}},\"simulateOpenLong(uint256)\":{\"params\":{\"quoteIn\":\"Amount of quote tokens to spend (18 decimals)\"},\"returns\":{\"avgPrice\":\"Average execution price Maps to perp.js lines 472-487 Math: - newQuoteReserve = quoteReserve + quoteIn - newBaseReserve = k / newQuoteReserve - baseOut = baseReserve - newBaseReserve - avgPrice = quoteIn / baseOut\",\"baseOut\":\"Amount of base tokens received\"}},\"simulateOpenShort(uint256)\":{\"params\":{\"quoteOut\":\"Desired notional value in quote tokens (18 decimals)\"},\"returns\":{\"avgPrice\":\"Average execution price Maps to perp.js lines 502-519 Math: - newQuoteReserve = quoteReserve - quoteOut - newBaseReserve = k / newQuoteReserve - baseIn = newBaseReserve - baseReserve - avgPrice = quoteOut / baseIn\",\"baseIn\":\"Amount of base tokens required\"}},\"updateFundingState(int256,uint256)\":{\"details\":\"Called by FundingManager after calculating new carry\",\"params\":{\"newCarryIndex\":\"New cumulative carry index\",\"newFundingBlock\":\"New last funding block\"}}},\"stateVariables\":{\"cumulativeCarryIndex\":{\"details\":\"This accumulates over time. Longs pay when positive, shorts when negative\"},\"k\":{\"details\":\"Cached to save gas vs recalculating each time\"}},\"title\":\"PerpMarket\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{\"advanceBlocks(uint256)\":{\"notice\":\"Advance block counter (for carry calculations)\"},\"baseReserve()\":{\"notice\":\"Virtual base asset reserve (18 decimals)\"},\"cumulativeCarryIndex()\":{\"notice\":\"Cumulative carry index (can be positive or negative)\"},\"currentBlock()\":{\"notice\":\"Current block number (for carry calculations)\"},\"decreaseOpenInterest(bool,uint256)\":{\"notice\":\"Decrease open interest for a side\"},\"engine()\":{\"notice\":\"Address of PerpEngine (only engine can modify state)\"},\"executeCloseLong(uint256)\":{\"notice\":\"Execute a close long trade (updates reserves)\"},\"executeCloseShort(uint256)\":{\"notice\":\"Execute a close short trade (updates reserves)\"},\"executeOpenLong(uint256)\":{\"notice\":\"Execute an open long trade (updates reserves)\"},\"executeOpenShort(uint256)\":{\"notice\":\"Execute an open short trade (updates reserves)\"},\"factory()\":{\"notice\":\"Address of deployer/factory (can set engine once)\"},\"getMarkPrice()\":{\"notice\":\"Get current mark price (spot price from vAMM)\"},\"increaseOpenInterest(bool,uint256)\":{\"notice\":\"Increase open interest for a side\"},\"k()\":{\"notice\":\"Cached invariant: k = baseReserve * quoteReserve\"},\"lastFundingBlock()\":{\"notice\":\"Last block when carry was updated\"},\"longOpenInterest()\":{\"notice\":\"Total notional value of long positions (18 decimals)\"},\"quoteReserve()\":{\"notice\":\"Virtual quote asset reserve (18 decimals)\"},\"setEngine(address)\":{\"notice\":\"Set the engine address (can only be called once by factory)\"},\"shortOpenInterest()\":{\"notice\":\"Total notional value of short positions (18 decimals)\"},\"simulateCloseLong(uint256)\":{\"notice\":\"Simulate closing a long position (selling base for quote)\"},\"simulateCloseShort(uint256)\":{\"notice\":\"Simulate closing a short position (buying base with quote)\"},\"simulateOpenLong(uint256)\":{\"notice\":\"Simulate opening a long position (buying base with quote)\"},\"simulateOpenShort(uint256)\":{\"notice\":\"Simulate opening a short position (selling base for quote)\"},\"updateFundingState(int256,uint256)\":{\"notice\":\"Update funding state (cumulative carry index and last funding block)\"}},\"notice\":\"Virtual AMM (vAMM) for perpetual futures trading\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"src/PerpMarket.sol\":\"PerpMarket\"},\"evmVersion\":\"shanghai\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":1000000},\"remappings\":[\":@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\":@solady/=lib/solady/src/\",\":erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/\",\":forge-std/=lib/forge-std/src/\",\":halmos-cheatcodes/=lib/openzeppelin-contracts/lib/halmos-cheatcodes/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\",\":solady/=lib/solady/src/\"],\"viaIR\":true},\"sources\":{\"src/PerpMarket.sol\":{\"keccak256\":\"0xce87fb1a4c97c50a06ca7830e3e1dd455dbf0fd2e262196324b8d35d97acd255\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://3ea15d4e8c1cfab3b22891df4db69283063a5414de08a40fc75e46e609b34256\",\"dweb:/ipfs/QmPCt7AHGS9jX76kT3i3voeHEyU7pLrBhkDkD1Jeu9tvfQ\"]}},\"version\":1}","metadata":{"compiler":{"version":"0.8.23+commit.f704f362"},"language":"Solidity","output":{"abi":[{"inputs":[{"internalType":"uint256","name":"_baseReserve","type":"uint256"},{"internalType":"uint256","name":"_quoteReserve","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"type":"error","name":"EngineAlreadySet"},{"inputs":[],"type":"error","name":"InsufficientLiquidity"},{"inputs":[],"type":"error","name":"InvalidReserves"},{"inputs":[],"type":"error","name":"Unauthorized"},{"inputs":[{"internalType":"uint256","name":"longOpenInterest","type":"uint256","indexed":false},{"internalType":"uint256","name":"shortOpenInterest","type":"uint256","indexed":false}],"type":"event","name":"OpenInterestUpdated","anonymous":false},{"inputs":[{"internalType":"uint256","name":"baseReserve","type":"uint256","indexed":false},{"internalType":"uint256","name":"quoteReserve","type":"uint256","indexed":false},{"internalType":"uint256","name":"markPrice","type":"uint256","indexed":false}],"type":"event","name":"ReservesUpdated","anonymous":false},{"inputs":[],"stateMutability":"view","type":"function","name":"PRECISION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"numBlocks","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"advanceBlocks"},{"inputs":[],"stateMutability":"view","type":"function","name":"baseReserve","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"cumulativeCarryIndex","outputs":[{"internalType":"int256","name":"","type":"int256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"currentBlock","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[{"internalType":"bool","name":"isLong","type":"bool"},{"internalType":"uint256","name":"notional","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"decreaseOpenInterest"},{"inputs":[],"stateMutability":"view","type":"function","name":"engine","outputs":[{"internalType":"address","name":"","type":"address"}]},{"inputs":[{"internalType":"uint256","name":"baseSize","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"executeCloseLong","outputs":[{"internalType":"uint256","name":"quoteOut","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"baseSize","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"executeCloseShort","outputs":[{"internalType":"uint256","name":"quoteIn","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"quoteIn","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"executeOpenLong","outputs":[{"internalType":"uint256","name":"baseOut","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"quoteOut","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"executeOpenShort","outputs":[{"internalType":"uint256","name":"baseIn","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"factory","outputs":[{"internalType":"address","name":"","type":"address"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"getMarkPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[{"internalType":"bool","name":"isLong","type":"bool"},{"internalType":"uint256","name":"notional","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"increaseOpenInterest"},{"inputs":[],"stateMutability":"view","type":"function","name":"k","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"lastFundingBlock","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"longOpenInterest","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"quoteReserve","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[{"internalType":"address","name":"_engine","type":"address"}],"stateMutability":"nonpayable","type":"function","name":"setEngine"},{"inputs":[],"stateMutability":"view","type":"function","name":"shortOpenInterest","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"baseSize","type":"uint256"}],"stateMutability":"view","type":"function","name":"simulateCloseLong","outputs":[{"internalType":"uint256","name":"quoteOut","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"baseSize","type":"uint256"}],"stateMutability":"view","type":"function","name":"simulateCloseShort","outputs":[{"internalType":"uint256","name":"quoteIn","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"quoteIn","type":"uint256"}],"stateMutability":"view","type":"function","name":"simulateOpenLong","outputs":[{"internalType":"uint256","name":"baseOut","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[{"internalType":"uint256","name":"quoteOut","type":"uint256"}],"stateMutability":"view","type":"function","name":"simulateOpenShort","outputs":[{"internalType":"uint256","name":"baseIn","type":"uint256"},{"internalType":"uint256","name":"avgPrice","type":"uint256"}]},{"inputs":[{"internalType":"int256","name":"newCarryIndex","type":"int256"},{"internalType":"uint256","name":"newFundingBlock","type":"uint256"}],"stateMutability":"nonpayable","type":"function","name":"updateFundingState"}],"devdoc":{"kind":"dev","methods":{"advanceBlocks(uint256)":{"params":{"numBlocks":"Number of blocks to advance"}},"constructor":{"params":{"_baseReserve":"Initial base reserve (18 decimals)","_quoteReserve":"Initial quote reserve (18 decimals)"}},"decreaseOpenInterest(bool,uint256)":{"params":{"isLong":"True for long, false for short","notional":"Notional value to remove (18 decimals)"}},"executeCloseLong(uint256)":{"params":{"baseSize":"Amount of base tokens to sell"},"returns":{"avgPrice":"Average execution price","quoteOut":"Amount of quote tokens received"}},"executeCloseShort(uint256)":{"params":{"baseSize":"Amount of base tokens to buy"},"returns":{"avgPrice":"Average execution price","quoteIn":"Amount of quote tokens required"}},"executeOpenLong(uint256)":{"params":{"quoteIn":"Amount of quote tokens to spend"},"returns":{"avgPrice":"Average execution price","baseOut":"Amount of base tokens received"}},"executeOpenShort(uint256)":{"params":{"quoteOut":"Desired notional value in quote tokens"},"returns":{"avgPrice":"Average execution price","baseIn":"Amount of base tokens required"}},"getMarkPrice()":{"details":"Mark price = quoteReserve / baseReserve","returns":{"_0":"Mark price in 18 decimal precision Maps to perp.js lines 364-366"}},"increaseOpenInterest(bool,uint256)":{"params":{"isLong":"True for long, false for short","notional":"Notional value to add (18 decimals)"}},"setEngine(address)":{"params":{"_engine":"Address of PerpEngine"}},"simulateCloseLong(uint256)":{"params":{"baseSize":"Amount of base tokens to sell (18 decimals)"},"returns":{"avgPrice":"Average execution price Maps to perp.js lines 533-544 Math: - newBaseReserve = baseReserve + baseSize - newQuoteReserve = k / newBaseReserve - quoteOut = quoteReserve - newQuoteReserve - avgPrice = quoteOut / baseSize","quoteOut":"Amount of quote tokens received"}},"simulateCloseShort(uint256)":{"params":{"baseSize":"Amount of base tokens to buy (18 decimals)"},"returns":{"avgPrice":"Average execution price Maps to perp.js lines 558-571 Math: - newBaseReserve = baseReserve - baseSize - newQuoteReserve = k / newBaseReserve - quoteIn = newQuoteReserve - quoteReserve - avgPrice = quoteIn / baseSize","quoteIn":"Amount of quote tokens required"}},"simulateOpenLong(uint256)":{"params":{"quoteIn":"Amount of quote tokens to spend (18 decimals)"},"returns":{"avgPrice":"Average execution price Maps to perp.js lines 472-487 Math: - newQuoteReserve = quoteReserve + quoteIn - newBaseReserve = k / newQuoteReserve - baseOut = baseReserve - newBaseReserve - avgPrice = quoteIn / baseOut","baseOut":"Amount of base tokens received"}},"simulateOpenShort(uint256)":{"params":{"quoteOut":"Desired notional value in quote tokens (18 decimals)"},"returns":{"avgPrice":"Average execution price Maps to perp.js lines 502-519 Math: - newQuoteReserve = quoteReserve - quoteOut - newBaseReserve = k / newQuoteReserve - baseIn = newBaseReserve - baseReserve - avgPrice = quoteOut / baseIn","baseIn":"Amount of base tokens required"}},"updateFundingState(int256,uint256)":{"details":"Called by FundingManager after calculating new carry","params":{"newCarryIndex":"New cumulative carry index","newFundingBlock":"New last funding block"}}},"version":1},"userdoc":{"kind":"user","methods":{"advanceBlocks(uint256)":{"notice":"Advance block counter (for carry calculations)"},"baseReserve()":{"notice":"Virtual base asset reserve (18 decimals)"},"cumulativeCarryIndex()":{"notice":"Cumulative carry index (can be positive or negative)"},"currentBlock()":{"notice":"Current block number (for carry calculations)"},"decreaseOpenInterest(bool,uint256)":{"notice":"Decrease open interest for a side"},"engine()":{"notice":"Address of PerpEngine (only engine can modify state)"},"executeCloseLong(uint256)":{"notice":"Execute a close long trade (updates reserves)"},"executeCloseShort(uint256)":{"notice":"Execute a close short trade (updates reserves)"},"executeOpenLong(uint256)":{"notice":"Execute an open long trade (updates reserves)"},"executeOpenShort(uint256)":{"notice":"Execute an open short trade (updates reserves)"},"factory()":{"notice":"Address of deployer/factory (can set engine once)"},"getMarkPrice()":{"notice":"Get current mark price (spot price from vAMM)"},"increaseOpenInterest(bool,uint256)":{"notice":"Increase open interest for a side"},"k()":{"notice":"Cached invariant: k = baseReserve * quoteReserve"},"lastFundingBlock()":{"notice":"Last block when carry was updated"},"longOpenInterest()":{"notice":"Total notional value of long positions (18 decimals)"},"quoteReserve()":{"notice":"Virtual quote asset reserve (18 decimals)"},"setEngine(address)":{"notice":"Set the engine address (can only be called once by factory)"},"shortOpenInterest()":{"notice":"Total notional value of short positions (18 decimals)"},"simulateCloseLong(uint256)":{"notice":"Simulate closing a long position (selling base for quote)"},"simulateCloseShort(uint256)":{"notice":"Simulate closing a short position (buying base with quote)"},"simulateOpenLong(uint256)":{"notice":"Simulate opening a long position (buying base with quote)"},"simulateOpenShort(uint256)":{"notice":"Simulate opening a short position (selling base for quote)"},"updateFundingState(int256,uint256)":{"notice":"Update funding state (cumulative carry index and last funding block)"}},"version":1}},"settings":{"remappings":["@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/","@solady/=lib/solady/src/","erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/","forge-std/=lib/forge-std/src/","halmos-cheatcodes/=lib/openzeppelin-contracts/lib/halmos-cheatcodes/src/","openzeppelin-contracts/=lib/openzeppelin-contracts/","solady/=lib/solady/src/"],"optimizer":{"enabled":true,"runs":1000000},"metadata":{"bytecodeHash":"ipfs"},"compilationTarget":{"src/PerpMarket.sol":"PerpMarket"},"evmVersion":"shanghai","libraries":{},"viaIR":true},"sources":{"src/PerpMarket.sol":{"keccak256":"0xce87fb1a4c97c50a06ca7830e3e1dd455dbf0fd2e262196324b8d35d97acd255","urls":["bzz-raw://3ea15d4e8c1cfab3b22891df4db69283063a5414de08a40fc75e46e609b34256","dweb:/ipfs/QmPCt7AHGS9jX76kT3i3voeHEyU7pLrBhkDkD1Jeu9tvfQ"],"license":"MIT"}},"version":1},"id":34}