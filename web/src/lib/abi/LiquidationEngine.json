{"abi":[{"type":"function","name":"EPSILON","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"LIQUIDATION_FEE_RATIO","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"PRECISION","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"calculateLiquidationFee","inputs":[{"name":"positionManager","type":"address","internalType":"contract PositionManager"},{"name":"market","type":"address","internalType":"contract PerpMarket"},{"name":"positionId","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"liqFee","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"getLiquidationInfo","inputs":[{"name":"positionManager","type":"address","internalType":"contract PositionManager"},{"name":"market","type":"address","internalType":"contract PerpMarket"},{"name":"positionId","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"isLiq","type":"bool","internalType":"bool"},{"name":"currentLoss","type":"uint256","internalType":"uint256"},{"name":"allowedLoss","type":"uint256","internalType":"uint256"},{"name":"equity","type":"int256","internalType":"int256"},{"name":"leverage","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"isLiquidatable","inputs":[{"name":"positionManager","type":"address","internalType":"contract PositionManager"},{"name":"market","type":"address","internalType":"contract PerpMarket"},{"name":"positionId","type":"uint256","internalType":"uint256"}],"outputs":[{"name":"","type":"bool","internalType":"bool"}],"stateMutability":"view"},{"type":"event","name":"PositionLiquidated","inputs":[{"name":"positionId","type":"uint256","indexed":true,"internalType":"uint256"},{"name":"user","type":"address","indexed":true,"internalType":"address"},{"name":"liquidator","type":"address","indexed":true,"internalType":"address"},{"name":"avgClosePrice","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"totalPnl","type":"int256","indexed":false,"internalType":"int256"},{"name":"equity","type":"int256","indexed":false,"internalType":"int256"},{"name":"liqFee","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"timestamp","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false},{"type":"error","name":"PositionNotLiquidatable","inputs":[]},{"type":"error","name":"PositionNotOpen","inputs":[]}],"bytecode":{"object":"0x6080806040523461001657610d4e908161001b8239f35b5f80fdfe60806040908082526004361015610014575f80fd5b5f3560e01c90816356cdf8231461033057508063a02fd4ae1461030c578063a26a24c9146102d2578063aaf5eb6814610292578063d12c952b146102555763e574ede914610060575f80fd5b34610251578061006f366103a4565b73ffffffffffffffffffffffffffffffffffffffff93929380948451927feb02c301000000000000000000000000000000000000000000000000000000008452600484015282602481610160948594165afa8015610247576024926060925f9261021a575b505080850151156101b4570151835194859384927f972fcff30000000000000000000000000000000000000000000000000000000084526004840152165afa9081156101aa575f9161017c575b505b6611c37937e080009081810291818304149015171561014f57670de0b6b3a76400006020925191048152f35b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b61019c9150823d84116101a3575b6101948183610404565b810190610d02565b505f610121565b503d61018a565b82513d5f823e3d90fd5b0151835194859384927fedbae33a0000000000000000000000000000000000000000000000000000000084526004840152165afa9081156101aa575f916101fc575b50610123565b6102139150823d84116101a3576101948183610404565b505f6101f6565b6102399250803d10610240575b6102318183610404565b81019061047f565b5f806100d4565b503d610227565b84513d5f823e3d90fd5b5f80fd5b5034610251575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610251576020905164e8d4a510008152f35b5034610251575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126102515760209051670de0b6b3a76400008152f35b50346102515760a0906102ed6102e7366103a4565b916109b3565b9394909281519515158652602086015284015260608301526080820152f35b503461025157602090610327610321366103a4565b9161059d565b90519015158152f35b34610251575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261025157806611c37937e0800060209252f35b8115610377570490565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc60609101126102515773ffffffffffffffffffffffffffffffffffffffff90600435828116810361025157916024359081168103610251579060443590565b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff82111761044557604052565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b5190811515820361025157565b809161016092839103126102515760405191820182811067ffffffffffffffff8211176104455760405280518252602081015173ffffffffffffffffffffffffffffffffffffffff811681036102515760208301526104e060408201610472565b6040830152606081015160608301526080810151608083015260a081015160a083015260c081015160c083015260e081015160e083015261010080820151908301526101208082015190600382101561025157830152610140809101519082015290565b91908260c09103126102515781519160208101519160408201519160608101519160a0608083015192015190565b8181029291811591840414171561014f57565b81810392915f13801582851316918412161761014f57565b909173ffffffffffffffffffffffffffffffffffffffff809216906040928351927fa32fce3b000000000000000000000000000000000000000000000000000000008452600495838786015260209060249582818881875afa9081156109a9575f91610974575b5015610910578651937feb02c30100000000000000000000000000000000000000000000000000000000855285898601526101609485818981885afa95861561094b575f96610955575b50506101008501519116908751907fe12ed13c00000000000000000000000000000000000000000000000000000000825283828b81865afa91821561094b575f9261091c575b5014610910578651947fbc5b83d20000000000000000000000000000000000000000000000000000000086528886015260c0858781865afa9485156108cd57908895949392915f956108d7575b5081908851968780927f604096320000000000000000000000000000000000000000000000000000000082525afa80156108cd575f9061089e575b6107379550670de0b6b3a76400009586916060860151610572565b0492858402938085048714901517156108735761075b60c08392019485519061036d565b878951809581937fdb24e2a20000000000000000000000000000000000000000000000000000000083528d8301525afa96871561086a57505f9661083a575b5050519080821315610832576107b09082610585565b935b82039082821161080757906107c691610572565b049264e8d4a5100084018094116107dd5750501190565b6011907f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b836011877f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b505f936107b2565b9080929650813d8311610863575b6108528183610404565b810103126102515751935f8061079a565b503d610848565b513d5f823e3d90fd5b8660118a7f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b508085813d83116108c6575b6108b48183610404565b8101031261025157610737945161071c565b503d6108aa565b87513d5f823e3d90fd5b829195506108fc9060c03d60c011610909575b6108f48183610404565b810190610544565b94505050505094906106e1565b503d6108ea565b50505050505050505f90565b9091508381813d8311610944575b6109348183610404565b810103126102515751905f610694565b503d61092a565b89513d5f823e3d90fd5b61096c929650803d10610240576102318183610404565b935f8061064e565b90508281813d83116109a2575b61098b8183610404565b810103126102515761099c90610472565b5f610604565b503d610981565b88513d5f823e3d90fd5b91905f9273ffffffffffffffffffffffffffffffffffffffff809116906040908151947fa32fce3b0000000000000000000000000000000000000000000000000000000086526004928184880152602060249781818a818a5afa908115610c68575f91610ccd575b5015610cb8578151907feb02c30100000000000000000000000000000000000000000000000000000000825283868301526101609182818b818b5afa928315610247575f93610c99575b50508251937fbc5b83d20000000000000000000000000000000000000000000000000000000085528685015260c0848a818a5afa938415610c68575f94610c72575b50808498878551809881937f60409632000000000000000000000000000000000000000000000000000000008352165afa8015610c68575f90610c39575b610b009550670de0b6b3a76400009586916060850151610572565b049185830292808404871490151715610c0e579080610b2660c08c94019485519061036d565b988551938480927fdb24e2a20000000000000000000000000000000000000000000000000000000082528c8c8301525afa93841561086a57505f93610bde575b50505191808313610bcb575b50820390828211610ba05790610b8791610572565b049364e8d4a510008501918286116107dd575050841194565b866011857f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b610bd791985082610585565b965f610b72565b9080929350813d8311610c07575b610bf68183610404565b810103126102515751905f80610b66565b503d610bec565b896011887f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b508085813d8311610c61575b610c4f8183610404565b8101031261025157610b009451610ae5565b503d610c45565b83513d5f823e3d90fd5b610c8c91945060c03d60c011610909576108f48183610404565b945050505050925f610aa7565b610cb0929350803d10610240576102318183610404565b905f80610a65565b5050505050505050505f905f905f905f905f90565b90508181813d8311610cfb575b610ce48183610404565b8101031261025157610cf590610472565b5f610a1b565b503d610cda565b919082604091031261025157602082519201519056fea26469706673582212201d7e6cacefab623e87e6baa58471387b643ceea2f2cbf3c51db8a3ca54d8485064736f6c63430008170033","sourceMap":"803:6511:34:-:0;;;;;;;;;;;;;;;;;","linkReferences":{}},"deployedBytecode":{"object":"0x60806040908082526004361015610014575f80fd5b5f3560e01c90816356cdf8231461033057508063a02fd4ae1461030c578063a26a24c9146102d2578063aaf5eb6814610292578063d12c952b146102555763e574ede914610060575f80fd5b34610251578061006f366103a4565b73ffffffffffffffffffffffffffffffffffffffff93929380948451927feb02c301000000000000000000000000000000000000000000000000000000008452600484015282602481610160948594165afa8015610247576024926060925f9261021a575b505080850151156101b4570151835194859384927f972fcff30000000000000000000000000000000000000000000000000000000084526004840152165afa9081156101aa575f9161017c575b505b6611c37937e080009081810291818304149015171561014f57670de0b6b3a76400006020925191048152f35b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b61019c9150823d84116101a3575b6101948183610404565b810190610d02565b505f610121565b503d61018a565b82513d5f823e3d90fd5b0151835194859384927fedbae33a0000000000000000000000000000000000000000000000000000000084526004840152165afa9081156101aa575f916101fc575b50610123565b6102139150823d84116101a3576101948183610404565b505f6101f6565b6102399250803d10610240575b6102318183610404565b81019061047f565b5f806100d4565b503d610227565b84513d5f823e3d90fd5b5f80fd5b5034610251575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc360112610251576020905164e8d4a510008152f35b5034610251575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126102515760209051670de0b6b3a76400008152f35b50346102515760a0906102ed6102e7366103a4565b916109b3565b9394909281519515158652602086015284015260608301526080820152f35b503461025157602090610327610321366103a4565b9161059d565b90519015158152f35b34610251575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc36011261025157806611c37937e0800060209252f35b8115610377570490565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc60609101126102515773ffffffffffffffffffffffffffffffffffffffff90600435828116810361025157916024359081168103610251579060443590565b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff82111761044557604052565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b5190811515820361025157565b809161016092839103126102515760405191820182811067ffffffffffffffff8211176104455760405280518252602081015173ffffffffffffffffffffffffffffffffffffffff811681036102515760208301526104e060408201610472565b6040830152606081015160608301526080810151608083015260a081015160a083015260c081015160c083015260e081015160e083015261010080820151908301526101208082015190600382101561025157830152610140809101519082015290565b91908260c09103126102515781519160208101519160408201519160608101519160a0608083015192015190565b8181029291811591840414171561014f57565b81810392915f13801582851316918412161761014f57565b909173ffffffffffffffffffffffffffffffffffffffff809216906040928351927fa32fce3b000000000000000000000000000000000000000000000000000000008452600495838786015260209060249582818881875afa9081156109a9575f91610974575b5015610910578651937feb02c30100000000000000000000000000000000000000000000000000000000855285898601526101609485818981885afa95861561094b575f96610955575b50506101008501519116908751907fe12ed13c00000000000000000000000000000000000000000000000000000000825283828b81865afa91821561094b575f9261091c575b5014610910578651947fbc5b83d20000000000000000000000000000000000000000000000000000000086528886015260c0858781865afa9485156108cd57908895949392915f956108d7575b5081908851968780927f604096320000000000000000000000000000000000000000000000000000000082525afa80156108cd575f9061089e575b6107379550670de0b6b3a76400009586916060860151610572565b0492858402938085048714901517156108735761075b60c08392019485519061036d565b878951809581937fdb24e2a20000000000000000000000000000000000000000000000000000000083528d8301525afa96871561086a57505f9661083a575b5050519080821315610832576107b09082610585565b935b82039082821161080757906107c691610572565b049264e8d4a5100084018094116107dd5750501190565b6011907f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b836011877f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b505f936107b2565b9080929650813d8311610863575b6108528183610404565b810103126102515751935f8061079a565b503d610848565b513d5f823e3d90fd5b8660118a7f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b508085813d83116108c6575b6108b48183610404565b8101031261025157610737945161071c565b503d6108aa565b87513d5f823e3d90fd5b829195506108fc9060c03d60c011610909575b6108f48183610404565b810190610544565b94505050505094906106e1565b503d6108ea565b50505050505050505f90565b9091508381813d8311610944575b6109348183610404565b810103126102515751905f610694565b503d61092a565b89513d5f823e3d90fd5b61096c929650803d10610240576102318183610404565b935f8061064e565b90508281813d83116109a2575b61098b8183610404565b810103126102515761099c90610472565b5f610604565b503d610981565b88513d5f823e3d90fd5b91905f9273ffffffffffffffffffffffffffffffffffffffff809116906040908151947fa32fce3b0000000000000000000000000000000000000000000000000000000086526004928184880152602060249781818a818a5afa908115610c68575f91610ccd575b5015610cb8578151907feb02c30100000000000000000000000000000000000000000000000000000000825283868301526101609182818b818b5afa928315610247575f93610c99575b50508251937fbc5b83d20000000000000000000000000000000000000000000000000000000085528685015260c0848a818a5afa938415610c68575f94610c72575b50808498878551809881937f60409632000000000000000000000000000000000000000000000000000000008352165afa8015610c68575f90610c39575b610b009550670de0b6b3a76400009586916060850151610572565b049185830292808404871490151715610c0e579080610b2660c08c94019485519061036d565b988551938480927fdb24e2a20000000000000000000000000000000000000000000000000000000082528c8c8301525afa93841561086a57505f93610bde575b50505191808313610bcb575b50820390828211610ba05790610b8791610572565b049364e8d4a510008501918286116107dd575050841194565b866011857f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b610bd791985082610585565b965f610b72565b9080929350813d8311610c07575b610bf68183610404565b810103126102515751905f80610b66565b503d610bec565b896011887f4e487b71000000000000000000000000000000000000000000000000000000005f52525ffd5b508085813d8311610c61575b610c4f8183610404565b8101031261025157610b009451610ae5565b503d610c45565b83513d5f823e3d90fd5b610c8c91945060c03d60c011610909576108f48183610404565b945050505050925f610aa7565b610cb0929350803d10610240576102318183610404565b905f80610a65565b5050505050505050505f905f905f905f905f90565b90508181813d8311610cfb575b610ce48183610404565b8101031261025157610cf590610472565b5f610a1b565b503d610cda565b919082604091031261025157602082519201519056fea26469706673582212201d7e6cacefab623e87e6baa58471387b643ceea2f2cbf3c51db8a3ca54d8485064736f6c63430008170033","sourceMap":"803:6511:34:-:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;6855:39;803:6511;6855:39;;803:6511;6855:39;;803:6511;6855:39;803:6511;6855:39;;803:6511;;;;6855:39;;;;;;803:6511;6855:39;7045:17;6855:39;803:6511;6855:39;;;803:6511;-1:-1:-1;;6970:15:34;;;803:6511;;;;7045:17;803:6511;;;7020:43;;;;;803:6511;7020:43;;803:6511;7020:43;;803:6511;;7020:43;;;;;;;803:6511;7020:43;;;6966:202;7001:62;6966:202;916:4;803:6511;;;;;;;;;;;;;;;916:4;803:6511;;;916:4;;803:6511;;;;916:4;803:6511;916:4;;803:6511;916:4;803:6511;;916:4;7020:43;;;;;;;;;;;;;;;:::i;:::-;;;;;:::i;:::-;;;;;;;;;;;803:6511;;;;;;;;;6966:202;7139:17;803:6511;;;7113:44;;;;;803:6511;7113:44;;803:6511;7113:44;;803:6511;;7113:44;;;;;;;803:6511;7113:44;;;6966:202;7094:63;6966:202;;7113:44;;;;;;;;;;;;;;:::i;:::-;;;;;6855:39;;;;;;-1:-1:-1;6855:39:34;;;;;;;:::i;:::-;;;;;:::i;:::-;;;;;;;;;;;803:6511;;;;;;;;;;;;;;;;;;;;;;;;;;;;960:4;803:6511;;;;;;;;;;;;;;;;;;916:4;803:6511;;;;;;;;;;;;;;:::i;:::-;;;:::i;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;:::i;:::-;;;;;;;;;;;;;;;;;;;;;916:4;803:6511;;;;916:4;;;;;;;:::o;:::-;;;;;;;;;;803:6511;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;-1:-1:-1;803:6511:34;;;;;;;;;;;;;:::o;2459:1968::-;;;803:6511;;;;;;;;;2683:42;803:6511;2683:42;;;;;;;;803:6511;2683:42;803:6511;;2683:42;;;;;;;;;;;;;-1:-1:-1;2683:42:34;;;2459:1968;2682:43;;2678:86;;803:6511;;2817:39;803:6511;2817:39;;;;;;803:6511;2817:39;;;;;;;;;;;;;;-1:-1:-1;2817:39:34;;;2459:1968;3004:18;;;;;803:6511;;;;;;3026:21;803:6511;3026:21;;;;;;;;;;;;;;-1:-1:-1;3026:21:34;;;2459:1968;3004:43;;3000:86;;803:6511;;3257:50;803:6511;3257:50;;;;;803:6511;3257:50;;;;;;;;;;;;803:6511;;;;;;;-1:-1:-1;3257:50:34;;;2459:1968;803:6511;;;;;3410:21;;;;803:6511;3410:21;;;;;;;;-1:-1:-1;3410:21:34;;;2459:1968;3464:29;916:4;;;3464:17;;;;;;803:6511;3464:29;:::i;:::-;916:4;803:6511;;;;;;;;;;;;;;;;3535:43;3257:50;3563:15;;;803:6511;;;3535:43;;:::i;:::-;803:6511;;;3688:51;;;;803:6511;3688:51;;;;;803:6511;3688:51;;;;;;;;-1:-1:-1;3688:51:34;;;2459:1968;-1:-1:-1;;803:6511:34;;3959:13;;;;;;4010;;;;:::i;:::-;3955:161;;803:6511;;;;;;;;4196:29;;;;:::i;:::-;916:4;803:6511;960:4;803:6511;;;;;;;4385:35;;;2459:1968;:::o;803:6511::-;916:4;;;-1:-1:-1;916:4:34;;-1:-1:-1;916:4:34;803:6511;916:4;;;;-1:-1:-1;916:4:34;;-1:-1:-1;916:4:34;3955:161;4055:15;-1:-1:-1;3955:161:34;;;3688:51;;;;;;;;;;;;;;;;;:::i;:::-;;;803:6511;;;;;3688:51;;;;;;;;;;;803:6511;;-1:-1:-1;803:6511:34;;;;;;916:4;;;;-1:-1:-1;916:4:34;;-1:-1:-1;916:4:34;3410:21;;;;;;;;;;;;;;;:::i;:::-;;;803:6511;;;;3464:29;803:6511;;3410:21;;;;;;;;803:6511;;;-1:-1:-1;803:6511:34;;;;;3257:50;;;;;;;;;;;;;;;;;;:::i;:::-;;;;;:::i;:::-;;;;;;;;;;;;;;;;3000:86;3063:12;;;;;;;;-1:-1:-1;3063:12:34;:::o;3026:21::-;;;;;;;;;;;;;;;;;:::i;:::-;;;803:6511;;;;;3026:21;;;;;;;;;;803:6511;;;-1:-1:-1;803:6511:34;;;;;2817:39;;;;;;;-1:-1:-1;2817:39:34;;;;;;:::i;:::-;;;;;;2683:42;;;;;;;;;;;;;;;;:::i;:::-;;;803:6511;;;;;;;:::i;:::-;2683:42;;;;;;;;;803:6511;;;-1:-1:-1;803:6511:34;;;;;4994:1336;;;803:6511;;;;;;;;;;;5347:42;803:6511;5347:42;;;;;;;;803:6511;5347:42;803:6511;5347:42;;;;;;;;;;;;;803:6511;5347:42;;;4994:1336;5346:43;;5342:100;;803:6511;;5495:39;803:6511;5495:39;;;;;;803:6511;5495:39;;;;;;;;;;;;;;803:6511;5495:39;;;4994:1336;803:6511;;;;5605:50;803:6511;5605:50;;;;;803:6511;5605:50;;;;;;;;;;;;803:6511;5605:50;;;4994:1336;5665:23;;;803:6511;;;;5749:21;;;;803:6511;5749:21;;803:6511;5749:21;;;;;;803:6511;5749:21;;;4994:1336;5803:29;916:4;;;5803:17;;;;;;803:6511;5803:29;:::i;:::-;916:4;803:6511;;;;;;;;;;;;;;;;5894:15;;5866:43;5605:50;5894:15;;;803:6511;;;5866:43;;:::i;:::-;803:6511;;;5970:51;;;;803:6511;5970:51;;;;;;803:6511;5970:51;;;;;;;;803:6511;5970:51;;;4994:1336;803:6511;;;6101:26;;;;6097:106;;4994:1336;803:6511;;;;;;;;;6228:29;;;;:::i;:::-;916:4;803:6511;960:4;803:6511;;;;;;;;6288:35;;;;4994:1336;:::o;803:6511::-;916:4;;;;803:6511;916:4;;803:6511;916:4;6097:106;6165:26;;;;;;:::i;:::-;6097:106;;;;5970:51;;;;;;;;;;;;;;;;;:::i;:::-;;;803:6511;;;;;5970:51;;;;;;;;;;803:6511;916:4;;;;803:6511;916:4;;803:6511;916:4;5749:21;;;;;;;;;;;;;;;:::i;:::-;;;803:6511;;;;5803:29;803:6511;;5749:21;;;;;;;;803:6511;;;;;;;;;5605:50;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;5495:39;;;;;;;-1:-1:-1;5495:39:34;;;;;;:::i;:::-;;;;;;5342:100;5405:26;;;;;;;;;803:6511;5405:26;803:6511;5405:26;803:6511;5405:26;803:6511;5405:26;803:6511;5405:26;:::o;5347:42::-;;;;;;;;;;;;;;;;:::i;:::-;;;803:6511;;;;;;;:::i;:::-;5347:42;;;;;;;;803:6511;;;;;;;;;;;;;;;;;:::o","linkReferences":{}},"methodIdentifiers":{"EPSILON()":"d12c952b","LIQUIDATION_FEE_RATIO()":"56cdf823","PRECISION()":"aaf5eb68","calculateLiquidationFee(address,address,uint256)":"e574ede9","getLiquidationInfo(address,address,uint256)":"a26a24c9","isLiquidatable(address,address,uint256)":"a02fd4ae"},"rawMetadata":"{\"compiler\":{\"version\":\"0.8.23+commit.f704f362\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"inputs\":[],\"name\":\"PositionNotLiquidatable\",\"type\":\"error\"},{\"inputs\":[],\"name\":\"PositionNotOpen\",\"type\":\"error\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"positionId\",\"type\":\"uint256\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"liquidator\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"avgClosePrice\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"int256\",\"name\":\"totalPnl\",\"type\":\"int256\"},{\"indexed\":false,\"internalType\":\"int256\",\"name\":\"equity\",\"type\":\"int256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"liqFee\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"}],\"name\":\"PositionLiquidated\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"EPSILON\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"LIQUIDATION_FEE_RATIO\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"PRECISION\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract PositionManager\",\"name\":\"positionManager\",\"type\":\"address\"},{\"internalType\":\"contract PerpMarket\",\"name\":\"market\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"positionId\",\"type\":\"uint256\"}],\"name\":\"calculateLiquidationFee\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"liqFee\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract PositionManager\",\"name\":\"positionManager\",\"type\":\"address\"},{\"internalType\":\"contract PerpMarket\",\"name\":\"market\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"positionId\",\"type\":\"uint256\"}],\"name\":\"getLiquidationInfo\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"isLiq\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"currentLoss\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"allowedLoss\",\"type\":\"uint256\"},{\"internalType\":\"int256\",\"name\":\"equity\",\"type\":\"int256\"},{\"internalType\":\"uint256\",\"name\":\"leverage\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract PositionManager\",\"name\":\"positionManager\",\"type\":\"address\"},{\"internalType\":\"contract PerpMarket\",\"name\":\"market\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"positionId\",\"type\":\"uint256\"}],\"name\":\"isLiquidatable\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"}],\"devdoc\":{\"details\":\"Maps to perp.js lines 1042-1119 (isLiquidatable) and 1253-1339 (liquidatePosition) Liquidation system: - Dynamic buffer ratios based on leverage (10% for \\u226410x, 20% for \\u226420x, 30% for >20x) - Positions are liquidatable when: currentLoss > allowedLoss - Where: allowedLoss = margin * (1 - bufferRatio) - Same-block liquidation protection (can't liquidate in opening block) NOTE: This contract is stateless and shared across all markets. PositionManager and PerpMarket are passed as function parameters.\",\"kind\":\"dev\",\"methods\":{\"calculateLiquidationFee(address,address,uint256)\":{\"params\":{\"market\":\"PerpMarket for this market\",\"positionId\":\"Position ID\",\"positionManager\":\"PositionManager for this market\"},\"returns\":{\"liqFee\":\"Liquidation fee amount\"}},\"getLiquidationInfo(address,address,uint256)\":{\"details\":\"Useful for keepers to decide if liquidation is profitable\",\"params\":{\"market\":\"PerpMarket for this market\",\"positionId\":\"Position ID\",\"positionManager\":\"PositionManager for this market\"},\"returns\":{\"allowedLoss\":\"Maximum allowed loss before liquidation\",\"currentLoss\":\"Current loss if closed now\",\"equity\":\"Current equity if closed\",\"isLiq\":\"True if position is liquidatable\",\"leverage\":\"Current leverage\"}},\"isLiquidatable(address,address,uint256)\":{\"details\":\"Maps to perp.js lines 1042-1119 Algorithm: 1. Check position exists and is OPEN 2. Check same-block protection (openBlock != currentBlock) 3. Simulate equity if closed now 4. Calculate current leverage 5. Get buffer ratio from leverage bucket 6. Calculate currentLoss = max(0, margin - equity) 7. Calculate allowedLoss = margin * (1 - bufferRatio) 8. Liquidatable if currentLoss > allowedLoss + EPSILON\",\"params\":{\"market\":\"PerpMarket for this market\",\"positionId\":\"Position ID to check\",\"positionManager\":\"PositionManager for this market\"},\"returns\":{\"_0\":\"True if position can be liquidated\"}}},\"title\":\"LiquidationEngine\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{\"LIQUIDATION_FEE_RATIO()\":{\"notice\":\"Liquidation fee ratio (from perp.js CONFIG line 58) 0.005 = 0.5% of close notional goes to liquidator\"},\"calculateLiquidationFee(address,address,uint256)\":{\"notice\":\"Calculate liquidation fee for a position\"},\"getLiquidationInfo(address,address,uint256)\":{\"notice\":\"Get liquidation information for a position\"},\"isLiquidatable(address,address,uint256)\":{\"notice\":\"Check if a position is liquidatable\"}},\"notice\":\"Shared liquidation logic for all perpetual futures markets\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"src/LiquidationEngine.sol\":\"LiquidationEngine\"},\"evmVersion\":\"shanghai\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":1000000},\"remappings\":[\":@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\":@solady/=lib/solady/src/\",\":erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/\",\":forge-std/=lib/forge-std/src/\",\":halmos-cheatcodes/=lib/openzeppelin-contracts/lib/halmos-cheatcodes/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\",\":solady/=lib/solady/src/\"],\"viaIR\":true},\"sources\":{\"src/LiquidationEngine.sol\":{\"keccak256\":\"0x7371630d571a17dba77b02acccdc25e14136194eb0321e3398b53a4fdc2147c5\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://d499ec4625daa056327e8d1878eaa06cd605ab97678b01adaac093fa58ab9b37\",\"dweb:/ipfs/QmYSTDQsV43TpQCQr2LMtnfPZyUUKkXucxwa35Vfg4CQ4J\"]},\"src/PerpMarket.sol\":{\"keccak256\":\"0xce87fb1a4c97c50a06ca7830e3e1dd455dbf0fd2e262196324b8d35d97acd255\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://3ea15d4e8c1cfab3b22891df4db69283063a5414de08a40fc75e46e609b34256\",\"dweb:/ipfs/QmPCt7AHGS9jX76kT3i3voeHEyU7pLrBhkDkD1Jeu9tvfQ\"]},\"src/PositionManager.sol\":{\"keccak256\":\"0xbd7dcdc3e924196dcbf495807ad492c8c68bb33c6a57ff1f1fc8acbf2c24904c\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://9d58f4d1a0de35dcea0f03469bf274e90f2ad2affef7af77dd190788329dfcb8\",\"dweb:/ipfs/QmSkWpMdACNA2Evw8XuvbF1seNBaf1zXVULKbEJCaq5qku\"]}},\"version\":1}","metadata":{"compiler":{"version":"0.8.23+commit.f704f362"},"language":"Solidity","output":{"abi":[{"inputs":[],"type":"error","name":"PositionNotLiquidatable"},{"inputs":[],"type":"error","name":"PositionNotOpen"},{"inputs":[{"internalType":"uint256","name":"positionId","type":"uint256","indexed":true},{"internalType":"address","name":"user","type":"address","indexed":true},{"internalType":"address","name":"liquidator","type":"address","indexed":true},{"internalType":"uint256","name":"avgClosePrice","type":"uint256","indexed":false},{"internalType":"int256","name":"totalPnl","type":"int256","indexed":false},{"internalType":"int256","name":"equity","type":"int256","indexed":false},{"internalType":"uint256","name":"liqFee","type":"uint256","indexed":false},{"internalType":"uint256","name":"timestamp","type":"uint256","indexed":false}],"type":"event","name":"PositionLiquidated","anonymous":false},{"inputs":[],"stateMutability":"view","type":"function","name":"EPSILON","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"LIQUIDATION_FEE_RATIO","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"PRECISION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[{"internalType":"contract PositionManager","name":"positionManager","type":"address"},{"internalType":"contract PerpMarket","name":"market","type":"address"},{"internalType":"uint256","name":"positionId","type":"uint256"}],"stateMutability":"view","type":"function","name":"calculateLiquidationFee","outputs":[{"internalType":"uint256","name":"liqFee","type":"uint256"}]},{"inputs":[{"internalType":"contract PositionManager","name":"positionManager","type":"address"},{"internalType":"contract PerpMarket","name":"market","type":"address"},{"internalType":"uint256","name":"positionId","type":"uint256"}],"stateMutability":"view","type":"function","name":"getLiquidationInfo","outputs":[{"internalType":"bool","name":"isLiq","type":"bool"},{"internalType":"uint256","name":"currentLoss","type":"uint256"},{"internalType":"uint256","name":"allowedLoss","type":"uint256"},{"internalType":"int256","name":"equity","type":"int256"},{"internalType":"uint256","name":"leverage","type":"uint256"}]},{"inputs":[{"internalType":"contract PositionManager","name":"positionManager","type":"address"},{"internalType":"contract PerpMarket","name":"market","type":"address"},{"internalType":"uint256","name":"positionId","type":"uint256"}],"stateMutability":"view","type":"function","name":"isLiquidatable","outputs":[{"internalType":"bool","name":"","type":"bool"}]}],"devdoc":{"kind":"dev","methods":{"calculateLiquidationFee(address,address,uint256)":{"params":{"market":"PerpMarket for this market","positionId":"Position ID","positionManager":"PositionManager for this market"},"returns":{"liqFee":"Liquidation fee amount"}},"getLiquidationInfo(address,address,uint256)":{"details":"Useful for keepers to decide if liquidation is profitable","params":{"market":"PerpMarket for this market","positionId":"Position ID","positionManager":"PositionManager for this market"},"returns":{"allowedLoss":"Maximum allowed loss before liquidation","currentLoss":"Current loss if closed now","equity":"Current equity if closed","isLiq":"True if position is liquidatable","leverage":"Current leverage"}},"isLiquidatable(address,address,uint256)":{"details":"Maps to perp.js lines 1042-1119 Algorithm: 1. Check position exists and is OPEN 2. Check same-block protection (openBlock != currentBlock) 3. Simulate equity if closed now 4. Calculate current leverage 5. Get buffer ratio from leverage bucket 6. Calculate currentLoss = max(0, margin - equity) 7. Calculate allowedLoss = margin * (1 - bufferRatio) 8. Liquidatable if currentLoss > allowedLoss + EPSILON","params":{"market":"PerpMarket for this market","positionId":"Position ID to check","positionManager":"PositionManager for this market"},"returns":{"_0":"True if position can be liquidated"}}},"version":1},"userdoc":{"kind":"user","methods":{"LIQUIDATION_FEE_RATIO()":{"notice":"Liquidation fee ratio (from perp.js CONFIG line 58) 0.005 = 0.5% of close notional goes to liquidator"},"calculateLiquidationFee(address,address,uint256)":{"notice":"Calculate liquidation fee for a position"},"getLiquidationInfo(address,address,uint256)":{"notice":"Get liquidation information for a position"},"isLiquidatable(address,address,uint256)":{"notice":"Check if a position is liquidatable"}},"version":1}},"settings":{"remappings":["@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/","@solady/=lib/solady/src/","erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/","forge-std/=lib/forge-std/src/","halmos-cheatcodes/=lib/openzeppelin-contracts/lib/halmos-cheatcodes/src/","openzeppelin-contracts/=lib/openzeppelin-contracts/","solady/=lib/solady/src/"],"optimizer":{"enabled":true,"runs":1000000},"metadata":{"bytecodeHash":"ipfs"},"compilationTarget":{"src/LiquidationEngine.sol":"LiquidationEngine"},"evmVersion":"shanghai","libraries":{},"viaIR":true},"sources":{"src/LiquidationEngine.sol":{"keccak256":"0x7371630d571a17dba77b02acccdc25e14136194eb0321e3398b53a4fdc2147c5","urls":["bzz-raw://d499ec4625daa056327e8d1878eaa06cd605ab97678b01adaac093fa58ab9b37","dweb:/ipfs/QmYSTDQsV43TpQCQr2LMtnfPZyUUKkXucxwa35Vfg4CQ4J"],"license":"MIT"},"src/PerpMarket.sol":{"keccak256":"0xce87fb1a4c97c50a06ca7830e3e1dd455dbf0fd2e262196324b8d35d97acd255","urls":["bzz-raw://3ea15d4e8c1cfab3b22891df4db69283063a5414de08a40fc75e46e609b34256","dweb:/ipfs/QmPCt7AHGS9jX76kT3i3voeHEyU7pLrBhkDkD1Jeu9tvfQ"],"license":"MIT"},"src/PositionManager.sol":{"keccak256":"0xbd7dcdc3e924196dcbf495807ad492c8c68bb33c6a57ff1f1fc8acbf2c24904c","urls":["bzz-raw://9d58f4d1a0de35dcea0f03469bf274e90f2ad2affef7af77dd190788329dfcb8","dweb:/ipfs/QmSkWpMdACNA2Evw8XuvbF1seNBaf1zXVULKbEJCaq5qku"],"license":"MIT"}},"version":1},"id":34}