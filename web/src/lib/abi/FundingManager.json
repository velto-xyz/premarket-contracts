{"abi":[{"type":"function","name":"BASE_CARRY_RATE_PER_BLOCK","inputs":[],"outputs":[{"name":"","type":"int256","internalType":"int256"}],"stateMutability":"view"},{"type":"function","name":"CARRY_SENSITIVITY","inputs":[],"outputs":[{"name":"","type":"int256","internalType":"int256"}],"stateMutability":"view"},{"type":"function","name":"PRECISION","inputs":[],"outputs":[{"name":"","type":"uint256","internalType":"uint256"}],"stateMutability":"view"},{"type":"function","name":"calculateCarryPnl","inputs":[{"name":"market","type":"address","internalType":"contract PerpMarket"},{"name":"isLong","type":"bool","internalType":"bool"},{"name":"notional","type":"uint256","internalType":"uint256"},{"name":"carrySnapshot","type":"int256","internalType":"int256"}],"outputs":[{"name":"carryPnl","type":"int256","internalType":"int256"}],"stateMutability":"view"},{"type":"function","name":"calculateUpdatedCarry","inputs":[{"name":"market","type":"address","internalType":"contract PerpMarket"}],"outputs":[{"name":"newCarryIndex","type":"int256","internalType":"int256"},{"name":"carryPerBlock","type":"int256","internalType":"int256"}],"stateMutability":"view"},{"type":"function","name":"getCurrentCarryIndex","inputs":[{"name":"market","type":"address","internalType":"contract PerpMarket"}],"outputs":[{"name":"","type":"int256","internalType":"int256"}],"stateMutability":"view"},{"type":"event","name":"CarryUpdated","inputs":[{"name":"blockNumber","type":"uint256","indexed":true,"internalType":"uint256"},{"name":"cumulativeCarryIndex","type":"int256","indexed":false,"internalType":"int256"},{"name":"carryPerBlock","type":"int256","indexed":false,"internalType":"int256"},{"name":"longOI","type":"uint256","indexed":false,"internalType":"uint256"},{"name":"shortOI","type":"uint256","indexed":false,"internalType":"uint256"}],"anonymous":false}],"bytecode":{"object":"0x6080806040523461001657610785908161001b8239f35b5f80fdfe60806040908082526004361015610014575f80fd5b5f3560e01c908163056d966c146102fd5750806326bd5b9c14610230578063aaf5eb68146101f0578063c4273832146101f0578063cb5fdf2f146100af5763e98c11fa14610060575f80fd5b346100ab5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab5761009f61009a610339565b61044d565b82519182526020820152f35b5f80fd5b50346100ab5760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab576100e7610339565b9060243580151581036100ab57602073ffffffffffffffffffffffffffffffffffffffff9360048451809681937f77fac304000000000000000000000000000000000000000000000000000000008352165afa9283156101e6575f936101b0575b5061019e670de0b6b3a76400009161016560209560643590610435565b90156101a6576101997fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff5b6044359061035c565b61035c565b059051908152f35b6101996001610190565b92506020833d6020116101de575b816101cb602093836103c7565b810103126100ab5791519161019e610148565b3d91506101be565b82513d5f823e3d90fd5b50346100ab575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab5760209051670de0b6b3a76400008152f35b50346100ab57602090817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab576004908273ffffffffffffffffffffffffffffffffffffffff610283610339565b168251938480927f77fac3040000000000000000000000000000000000000000000000000000000082525afa9182156102f3575f926102c4575b5051908152f35b9091508281813d83116102ec575b6102dc81836103c7565b810103126100ab5751905f6102bd565b503d6102d2565b50513d5f823e3d90fd5b346100ab575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab5780655af3107a400060209252f35b6004359073ffffffffffffffffffffffffffffffffffffffff821682036100ab57565b81810292915f82127f800000000000000000000000000000000000000000000000000000000000000082141661039a57818405149015171561039a57565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff82111761040857604052565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b81810392915f13801582851316918412161761039a57565b73ffffffffffffffffffffffffffffffffffffffff1660408051917f97fb7289000000000000000000000000000000000000000000000000000000008352602060049381818681865afa908115610745575f91610718575b508351917ff67908b500000000000000000000000000000000000000000000000000000000835280838781875afa92831561070e575f936106df575b50828201938483116106b357908087928751938480927f77fac3040000000000000000000000000000000000000000000000000000000082525afa9586156106aa57505f9561067a575b50508215610670579061053d91610435565b670de0b6b3a764000090818102918183051490151715610644577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82147f800000000000000000000000000000000000000000000000000000000000000082141661064457056d04ee2d6d415b85acef81000000009080820291820503610618576ec097ce7bc90715b34b9f1000000000900591828201915f84841291129080158216911516176105ec575091565b6011907f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b6011837f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b6011847f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b5050509050905f90565b9080929550813d83116106a3575b61069281836103c7565b810103126100ab5751925f8061052b565b503d610688565b513d5f823e3d90fd5b6011877f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b9080935081813d8311610707575b6106f781836103c7565b810103126100ab5751915f6104e1565b503d6106ed565b85513d5f823e3d90fd5b90508181813d831161073e575b61072f81836103c7565b810103126100ab57515f6104a5565b503d610725565b84513d5f823e3d90fdfea264697066735822122073dd1b4e4cd3412fdbdfcfd1692ee313f0fa618cf877cc738984d8e0f14a6c3764736f6c63430008170033","sourceMap":"607:4016:33:-:0;;;;;;;;;;;;;;;;;","linkReferences":{}},"deployedBytecode":{"object":"0x60806040908082526004361015610014575f80fd5b5f3560e01c908163056d966c146102fd5750806326bd5b9c14610230578063aaf5eb68146101f0578063c4273832146101f0578063cb5fdf2f146100af5763e98c11fa14610060575f80fd5b346100ab5760207ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab5761009f61009a610339565b61044d565b82519182526020820152f35b5f80fd5b50346100ab5760807ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab576100e7610339565b9060243580151581036100ab57602073ffffffffffffffffffffffffffffffffffffffff9360048451809681937f77fac304000000000000000000000000000000000000000000000000000000008352165afa9283156101e6575f936101b0575b5061019e670de0b6b3a76400009161016560209560643590610435565b90156101a6576101997fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff5b6044359061035c565b61035c565b059051908152f35b6101996001610190565b92506020833d6020116101de575b816101cb602093836103c7565b810103126100ab5791519161019e610148565b3d91506101be565b82513d5f823e3d90fd5b50346100ab575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab5760209051670de0b6b3a76400008152f35b50346100ab57602090817ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab576004908273ffffffffffffffffffffffffffffffffffffffff610283610339565b168251938480927f77fac3040000000000000000000000000000000000000000000000000000000082525afa9182156102f3575f926102c4575b5051908152f35b9091508281813d83116102ec575b6102dc81836103c7565b810103126100ab5751905f6102bd565b503d6102d2565b50513d5f823e3d90fd5b346100ab575f7ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc3601126100ab5780655af3107a400060209252f35b6004359073ffffffffffffffffffffffffffffffffffffffff821682036100ab57565b81810292915f82127f800000000000000000000000000000000000000000000000000000000000000082141661039a57818405149015171561039a57565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b90601f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0910116810190811067ffffffffffffffff82111761040857604052565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b81810392915f13801582851316918412161761039a57565b73ffffffffffffffffffffffffffffffffffffffff1660408051917f97fb7289000000000000000000000000000000000000000000000000000000008352602060049381818681865afa908115610745575f91610718575b508351917ff67908b500000000000000000000000000000000000000000000000000000000835280838781875afa92831561070e575f936106df575b50828201938483116106b357908087928751938480927f77fac3040000000000000000000000000000000000000000000000000000000082525afa9586156106aa57505f9561067a575b50508215610670579061053d91610435565b670de0b6b3a764000090818102918183051490151715610644577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82147f800000000000000000000000000000000000000000000000000000000000000082141661064457056d04ee2d6d415b85acef81000000009080820291820503610618576ec097ce7bc90715b34b9f1000000000900591828201915f84841291129080158216911516176105ec575091565b6011907f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b6011837f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b6011847f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b5050509050905f90565b9080929550813d83116106a3575b61069281836103c7565b810103126100ab5751925f8061052b565b503d610688565b513d5f823e3d90fd5b6011877f4e487b71000000000000000000000000000000000000000000000000000000005f525260245ffd5b9080935081813d8311610707575b6106f781836103c7565b810103126100ab5751915f6104e1565b503d6106ed565b85513d5f823e3d90fd5b90508181813d831161073e575b61072f81836103c7565b810103126100ab57515f6104a5565b503d610725565b84513d5f823e3d90fdfea264697066735822122073dd1b4e4cd3412fdbdfcfd1692ee313f0fa618cf877cc738984d8e0f14a6c3764736f6c63430008170033","sourceMap":"607:4016:33:-:0;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;:::i;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;;;;;;;;;;;;;;;4292:29;;;;607:4016;4292:29;;607:4016;4292:29;;;;;;;607:4016;4292:29;;;607:4016;;4553:40;717:4;607:4016;4292:45;607:4016;;;;4292:45;;:::i;:::-;4499:31;;;;4553:27;4515:2;4499:31;607:4016;;4553:27;;:::i;:::-;:40;:::i;:::-;717:4;607:4016;;;;;;4499:31;4553:27;607:4016;4499:31;;4292:29;;;607:4016;4292:29;;607:4016;4292:29;;;;;;607:4016;4292:29;;;:::i;:::-;;;607:4016;;;;;;;4553:40;4292:29;;;;;-1:-1:-1;4292:29:33;;;607:4016;;;;;;;;;;;;;;;;;;;;;;;;717:4;607:4016;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;;3586:29;;;;607:4016;3586:29;;;;;;;;;607:4016;3586:29;;;607:4016;;;;;;;3586:29;;;;;;;;;;;;;;;;;:::i;:::-;;;607:4016;;;;;3586:29;;;;;;;;;;607:4016;;;;;;;;;;;;;;;;;;;;;717:4;607:4016;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;;;;;;:::o;:::-;717:4;607:4016;717:4;;;;;607:4016;717:4;607:4016;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;;;;;;;;;;;-1:-1:-1;607:4016:33;;;;;;;;;;;;;:::o;2093:1157::-;607:4016;;;;;2267:25;607:4016;2267:25;;;;;;;;;;;;;;;;;;;;;2093:1157;607:4016;;;2320:26;607:4016;2320:26;;;;;;;;;;;;;;2267:25;2320:26;;;2093:1157;607:4016;;;;;;;;;;;;;;;;2468:29;;;;607:4016;2468:29;;;;;;;;;;2267:25;2468:29;;;2093:1157;2561:12;;;;2557:75;;2768:32;;;;:::i;:::-;717:4;607:4016;;;;;;;;;;;;;;;717:4;;;;;;;;;;607:4016;;;;;;;;;;;;717:4;;607:4016;;;;;2267:25;607:4016;;;;;;;;;;;;;;;;3191:52;2093:1157;:::o;607:4016::-;717:4;;;2267:25;717:4;;;2267:25;717:4;607:4016;717:4;;;2267:25;717:4;;;2267:25;717:4;;;;;2267:25;717:4;;;2267:25;717:4;2557:75;2589:32;;;;;;2267:25;2589:32;:::o;2468:29::-;;;;;;;;;;;;;;;;;:::i;:::-;;;607:4016;;;;;2468:29;;;;;;;;;;;607:4016;;2267:25;607:4016;;;;;;717:4;;;2267:25;717:4;;;2267:25;717:4;2320:26;;;;;;;;;;;;;;;;;:::i;:::-;;;607:4016;;;;;2320:26;;;;;;;;;;607:4016;;;2267:25;607:4016;;;;;2267:25;;;;;;;;;;;;;;;;:::i;:::-;;;607:4016;;;;;2267:25;;;;;;;;;607:4016;;;2267:25;607:4016;;;;","linkReferences":{}},"methodIdentifiers":{"BASE_CARRY_RATE_PER_BLOCK()":"056d966c","CARRY_SENSITIVITY()":"c4273832","PRECISION()":"aaf5eb68","calculateCarryPnl(address,bool,uint256,int256)":"cb5fdf2f","calculateUpdatedCarry(address)":"e98c11fa","getCurrentCarryIndex(address)":"26bd5b9c"},"rawMetadata":"{\"compiler\":{\"version\":\"0.8.23+commit.f704f362\"},\"language\":\"Solidity\",\"output\":{\"abi\":[{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"blockNumber\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"int256\",\"name\":\"cumulativeCarryIndex\",\"type\":\"int256\"},{\"indexed\":false,\"internalType\":\"int256\",\"name\":\"carryPerBlock\",\"type\":\"int256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"longOI\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"shortOI\",\"type\":\"uint256\"}],\"name\":\"CarryUpdated\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"BASE_CARRY_RATE_PER_BLOCK\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"\",\"type\":\"int256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"CARRY_SENSITIVITY\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"\",\"type\":\"int256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"PRECISION\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract PerpMarket\",\"name\":\"market\",\"type\":\"address\"},{\"internalType\":\"bool\",\"name\":\"isLong\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"notional\",\"type\":\"uint256\"},{\"internalType\":\"int256\",\"name\":\"carrySnapshot\",\"type\":\"int256\"}],\"name\":\"calculateCarryPnl\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"carryPnl\",\"type\":\"int256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract PerpMarket\",\"name\":\"market\",\"type\":\"address\"}],\"name\":\"calculateUpdatedCarry\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"newCarryIndex\",\"type\":\"int256\"},{\"internalType\":\"int256\",\"name\":\"carryPerBlock\",\"type\":\"int256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"contract PerpMarket\",\"name\":\"market\",\"type\":\"address\"}],\"name\":\"getCurrentCarryIndex\",\"outputs\":[{\"internalType\":\"int256\",\"name\":\"\",\"type\":\"int256\"}],\"stateMutability\":\"view\",\"type\":\"function\"}],\"devdoc\":{\"details\":\"Maps to perp.js lines 421-438 (updateCarryForCurrentBlock) Carry mechanism: - When long OI > short OI: longs pay shorts (positive carry index) - When short OI > long OI: shorts pay longs (negative carry index) - Carry accrues per block based on OI imbalance NOTE: This contract is stateless and shared across all markets. Funding state is stored in PerpMarket.\",\"kind\":\"dev\",\"methods\":{\"calculateCarryPnl(address,bool,uint256,int256)\":{\"details\":\"This is a helper function to calculate carry PnL without reading position state\",\"params\":{\"carrySnapshot\":\"Carry index when position was opened\",\"isLong\":\"True for long position, false for short\",\"market\":\"PerpMarket to query\",\"notional\":\"Position notional value (18 decimals)\"},\"returns\":{\"carryPnl\":\"Carry PnL (can be positive or negative)\"}},\"calculateUpdatedCarry(address)\":{\"details\":\"Maps to perp.js lines 421-438 Algorithm: 1. Get total OI (long + short) 2. If OI is zero, return current index 3. Calculate imbalance ratio: (longOI - shortOI) / totalOI 4. Calculate carry per block: BASE_RATE * SENSITIVITY * imbalanceRatio 5. Return updated cumulative carry index Note: carryPerBlock can be positive (longs pay) or negative (shorts pay) Note: Caller (PerpEngine) must update market state\",\"params\":{\"market\":\"PerpMarket to calculate funding for\"},\"returns\":{\"carryPerBlock\":\"Carry per block (for event emission)\",\"newCarryIndex\":\"New cumulative carry index\"}},\"getCurrentCarryIndex(address)\":{\"params\":{\"market\":\"PerpMarket to query\"},\"returns\":{\"_0\":\"Current carry index (can be positive or negative)\"}}},\"title\":\"FundingManager\",\"version\":1},\"userdoc\":{\"kind\":\"user\",\"methods\":{\"BASE_CARRY_RATE_PER_BLOCK()\":{\"notice\":\"Base carry rate per block (from perp.js CONFIG line 87) 0.0001 = 0.01% per block\"},\"CARRY_SENSITIVITY()\":{\"notice\":\"Carry sensitivity multiplier (from perp.js CONFIG line 88)\"},\"calculateCarryPnl(address,bool,uint256,int256)\":{\"notice\":\"Calculate carry PnL for a position\"},\"calculateUpdatedCarry(address)\":{\"notice\":\"Calculate new carry index for the current block\"},\"getCurrentCarryIndex(address)\":{\"notice\":\"Get current cumulative carry index from market\"}},\"notice\":\"Shared funding calculation logic for all perpetual futures markets\",\"version\":1}},\"settings\":{\"compilationTarget\":{\"src/FundingManager.sol\":\"FundingManager\"},\"evmVersion\":\"shanghai\",\"libraries\":{},\"metadata\":{\"bytecodeHash\":\"ipfs\"},\"optimizer\":{\"enabled\":true,\"runs\":1000000},\"remappings\":[\":@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\":@solady/=lib/solady/src/\",\":erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/\",\":forge-std/=lib/forge-std/src/\",\":halmos-cheatcodes/=lib/openzeppelin-contracts/lib/halmos-cheatcodes/src/\",\":openzeppelin-contracts/=lib/openzeppelin-contracts/\",\":solady/=lib/solady/src/\"],\"viaIR\":true},\"sources\":{\"src/FundingManager.sol\":{\"keccak256\":\"0x39253ee414818b1fc2d2d6e31073c49dedfe6ee7d0224aee32fee0173637c538\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://36cfdf9b74a102b25a6c40adb87e35d0c1989ab6ee9fc73944dee496a8d66c38\",\"dweb:/ipfs/QmVzZaYQKYKiozN3nvgPZ6aCThgC8vfK38RY5GXQ5sXWHo\"]},\"src/PerpMarket.sol\":{\"keccak256\":\"0xce87fb1a4c97c50a06ca7830e3e1dd455dbf0fd2e262196324b8d35d97acd255\",\"license\":\"MIT\",\"urls\":[\"bzz-raw://3ea15d4e8c1cfab3b22891df4db69283063a5414de08a40fc75e46e609b34256\",\"dweb:/ipfs/QmPCt7AHGS9jX76kT3i3voeHEyU7pLrBhkDkD1Jeu9tvfQ\"]}},\"version\":1}","metadata":{"compiler":{"version":"0.8.23+commit.f704f362"},"language":"Solidity","output":{"abi":[{"inputs":[{"internalType":"uint256","name":"blockNumber","type":"uint256","indexed":true},{"internalType":"int256","name":"cumulativeCarryIndex","type":"int256","indexed":false},{"internalType":"int256","name":"carryPerBlock","type":"int256","indexed":false},{"internalType":"uint256","name":"longOI","type":"uint256","indexed":false},{"internalType":"uint256","name":"shortOI","type":"uint256","indexed":false}],"type":"event","name":"CarryUpdated","anonymous":false},{"inputs":[],"stateMutability":"view","type":"function","name":"BASE_CARRY_RATE_PER_BLOCK","outputs":[{"internalType":"int256","name":"","type":"int256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"CARRY_SENSITIVITY","outputs":[{"internalType":"int256","name":"","type":"int256"}]},{"inputs":[],"stateMutability":"view","type":"function","name":"PRECISION","outputs":[{"internalType":"uint256","name":"","type":"uint256"}]},{"inputs":[{"internalType":"contract PerpMarket","name":"market","type":"address"},{"internalType":"bool","name":"isLong","type":"bool"},{"internalType":"uint256","name":"notional","type":"uint256"},{"internalType":"int256","name":"carrySnapshot","type":"int256"}],"stateMutability":"view","type":"function","name":"calculateCarryPnl","outputs":[{"internalType":"int256","name":"carryPnl","type":"int256"}]},{"inputs":[{"internalType":"contract PerpMarket","name":"market","type":"address"}],"stateMutability":"view","type":"function","name":"calculateUpdatedCarry","outputs":[{"internalType":"int256","name":"newCarryIndex","type":"int256"},{"internalType":"int256","name":"carryPerBlock","type":"int256"}]},{"inputs":[{"internalType":"contract PerpMarket","name":"market","type":"address"}],"stateMutability":"view","type":"function","name":"getCurrentCarryIndex","outputs":[{"internalType":"int256","name":"","type":"int256"}]}],"devdoc":{"kind":"dev","methods":{"calculateCarryPnl(address,bool,uint256,int256)":{"details":"This is a helper function to calculate carry PnL without reading position state","params":{"carrySnapshot":"Carry index when position was opened","isLong":"True for long position, false for short","market":"PerpMarket to query","notional":"Position notional value (18 decimals)"},"returns":{"carryPnl":"Carry PnL (can be positive or negative)"}},"calculateUpdatedCarry(address)":{"details":"Maps to perp.js lines 421-438 Algorithm: 1. Get total OI (long + short) 2. If OI is zero, return current index 3. Calculate imbalance ratio: (longOI - shortOI) / totalOI 4. Calculate carry per block: BASE_RATE * SENSITIVITY * imbalanceRatio 5. Return updated cumulative carry index Note: carryPerBlock can be positive (longs pay) or negative (shorts pay) Note: Caller (PerpEngine) must update market state","params":{"market":"PerpMarket to calculate funding for"},"returns":{"carryPerBlock":"Carry per block (for event emission)","newCarryIndex":"New cumulative carry index"}},"getCurrentCarryIndex(address)":{"params":{"market":"PerpMarket to query"},"returns":{"_0":"Current carry index (can be positive or negative)"}}},"version":1},"userdoc":{"kind":"user","methods":{"BASE_CARRY_RATE_PER_BLOCK()":{"notice":"Base carry rate per block (from perp.js CONFIG line 87) 0.0001 = 0.01% per block"},"CARRY_SENSITIVITY()":{"notice":"Carry sensitivity multiplier (from perp.js CONFIG line 88)"},"calculateCarryPnl(address,bool,uint256,int256)":{"notice":"Calculate carry PnL for a position"},"calculateUpdatedCarry(address)":{"notice":"Calculate new carry index for the current block"},"getCurrentCarryIndex(address)":{"notice":"Get current cumulative carry index from market"}},"version":1}},"settings":{"remappings":["@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/","@solady/=lib/solady/src/","erc4626-tests/=lib/openzeppelin-contracts/lib/erc4626-tests/","forge-std/=lib/forge-std/src/","halmos-cheatcodes/=lib/openzeppelin-contracts/lib/halmos-cheatcodes/src/","openzeppelin-contracts/=lib/openzeppelin-contracts/","solady/=lib/solady/src/"],"optimizer":{"enabled":true,"runs":1000000},"metadata":{"bytecodeHash":"ipfs"},"compilationTarget":{"src/FundingManager.sol":"FundingManager"},"evmVersion":"shanghai","libraries":{},"viaIR":true},"sources":{"src/FundingManager.sol":{"keccak256":"0x39253ee414818b1fc2d2d6e31073c49dedfe6ee7d0224aee32fee0173637c538","urls":["bzz-raw://36cfdf9b74a102b25a6c40adb87e35d0c1989ab6ee9fc73944dee496a8d66c38","dweb:/ipfs/QmVzZaYQKYKiozN3nvgPZ6aCThgC8vfK38RY5GXQ5sXWHo"],"license":"MIT"},"src/PerpMarket.sol":{"keccak256":"0xce87fb1a4c97c50a06ca7830e3e1dd455dbf0fd2e262196324b8d35d97acd255","urls":["bzz-raw://3ea15d4e8c1cfab3b22891df4db69283063a5414de08a40fc75e46e609b34256","dweb:/ipfs/QmPCt7AHGS9jX76kT3i3voeHEyU7pLrBhkDkD1Jeu9tvfQ"],"license":"MIT"}},"version":1},"id":33}