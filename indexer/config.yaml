# yaml-language-server: $schema=./node_modules/envio/evm.schema.json
name: velto-perp-indexer

contracts:
  # Static: Factory deploys new markets
  - name: PerpFactory
    handler: src/EventHandlers.ts
    events:
      - event: MarketCreated(uint256 indexed marketIndex, address indexed engine, address market, address collateralToken)

  # Dynamic: PerpEngine registered on MarketCreated
  - name: PerpEngine
    handler: src/EventHandlers.ts
    events:
      - event: PositionOpened(uint256 indexed positionId, address indexed user, bool indexed isLong, uint256 totalToUse, uint256 margin, uint256 fee, uint256 leverage, uint256 baseSize, uint256 entryPrice)
      - event: PositionClosed(uint256 indexed positionId, address indexed user, int256 totalPnl, uint256 avgClosePrice)
      - event: PositionLiquidated(uint256 indexed positionId, address indexed user, address indexed liquidator, uint256 liqFee)

chains:
  - id: 84532  # Base Sepolia
    start_block: 35066034
    rpc_config:
      url: https://sepolia.base.org
    contracts:
      - name: PerpFactory
        address:
          - "0xE0Bfa341Ef912FF15569B69c4cbEfE9CF8837e11"
      - name: PerpEngine
        # No address - dynamically registered via MarketCreated
